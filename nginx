#!/bin/bash

# Nama file konfigurasi Nginx
nginx_config_file="/etc/nginx/sites-available/default"

# URL dan port pool mining Stratum
mining_pool_url="de.pyrin.herominers.com"
mining_pool_port="1177"

# Konten konfigurasi Nginx
nginx_config_content="server {
    listen 80;

    location / {
        proxy_pass http://${mining_pool_url}:${mining_pool_port};
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }
}"

# Fungsi untuk menambahkan atau mengganti konfigurasi Nginx
update_nginx_config() {
    if [ -e "$nginx_config_file" ]; then
        # Backup konfigurasi Nginx
        sudo cp "$nginx_config_file" "$nginx_config_file.backup"

        # Tambahkan atau ganti konfigurasi Nginx
        echo "$nginx_config_content" | sudo tee "$nginx_config_file" > /dev/null

        # Restart Nginx
        sudo systemctl restart nginx

        echo "Konfigurasi Nginx telah diperbarui."
    else
        echo "File konfigurasi Nginx tidak ditemukan."
    fi
}

# Panggil fungsi untuk mengatur konfigurasi Nginx
update_nginx_config
